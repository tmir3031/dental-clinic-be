<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">

    <changeSet author="raluca.timonea" id="000">
        <comment>Create sequence for generating surrogate keys for specialization.</comment>
        <createSequence sequenceName="SPECIALIZATION_ID_SQ"/>

        <comment>Create sequence for generating surrogate keys for appointment.</comment>
        <createSequence sequenceName="APPOINTMENT_ID_SQ"/>

        <comment>Create sequence for generating surrogate keys for team employee</comment>
        <createSequence sequenceName="USER_SPECIALIZATION_ID_SQ" startValue="1"/>
    </changeSet>

    <changeSet author="raluca.timonea" id="001">
        <createTable tableName="SPECIALIZATION" remarks="Specialization details.">
            <column name="ID" type="BIGINT" remarks="Generated surrogate key.">
                <constraints nullable="false" primaryKey="true" primaryKeyName="SPECIALIZATION_PK"/>
            </column>
            <column name="NAME" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="V" type="INT" remarks="Technical version of this record">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="CLIENT" remarks="User details.">
            <column name="USER_ID" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="USER_PK"/>
            </column>
            <column name="USERNAME" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="FIRST_NAME" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_NAME" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="EMAIL" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="CRT_USR" type="VARCHAR(255)"
                    remarks="User that created this record">
                <constraints nullable="false"/>
            </column>
            <column name="CRT_TMS" type="DATETIME"
                    remarks="Timestamp of the record's creation">
                <constraints nullable="false"/>
            </column>
            <column name="MDF_USR" type="VARCHAR(255)" remarks="User that modified last this record">
                <constraints nullable="false"/>
            </column>
            <column name="MDF_TMS" type="DATETIME" remarks="Timestamp of the record's last modification">
                <constraints nullable="false"/>
            </column>
            <column name="ROLE" type="VARCHAR(255)" remarks="Role of user" defaultValue="USER">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="VARCHAR(255)" remarks="Status of user">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="VARCHAR(255)" remarks="Description of user">
                <constraints nullable="false"/>
            </column>
            <column name="V" type="INT" remarks="Technical version of this record">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="USER_SPECIALIZATION" remarks="Relationship between doctor and specialization details.">
            <column name="ID" type="BIGINT" remarks="Generated surrogate key.">
                <constraints nullable="false" primaryKey="true" primaryKeyName="SPECIALIZATION_USER_PK"/>
            </column>
            <column name="USER_ID" type="VARCHAR(255)" remarks="Id of user">
                <constraints nullable="false"
                            foreignKeyName="SPECIALIZATION_USER_USER_FK"
                             references="CLIENT(USER_ID)"/>
            </column>
            <column name="SPECIALIZATION_ID" type="BIGINT" remarks="Id of specialization">
                <constraints nullable="false"
                        foreignKeyName="SPECIALIZATION_USER_SPECIALIZATION_FK"
                        references="SPECIALIZATION(ID)"/>
            </column>
        </createTable>

        <createTable remarks="Legally days off details." tableName="LEGALLY_DAYS_OFF">
            <column name="DATE" remarks="Date of day off." type="DATE">
                <constraints nullable="false" primaryKey="true" primaryKeyName="LEGALLY_DAYS_OFF_PK"/>
            </column>
            <column name="DESCRIPTION" remarks="Description of day off" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable remarks="Appointment details." tableName="APPOINTMENT">
            <column name="ID" type="BIGINT" remarks="Generated surrogate key.">
                <constraints nullable="false" primaryKey="true" primaryKeyName="APPOINTMENT_ID"/>
            </column>
            <column name="USER_ID" type="VARCHAR2(255)"
                    remarks="Id of the user that appointment">
                <constraints nullable="false"
                             foreignKeyName="APPOINTMENT_USER_FK"
                             references="CLIENT(USER_ID)"/>
            </column>
            <column name="CRT_USR" type="VARCHAR(255)"
                    remarks="User that created this record">
                <constraints nullable="false"/>
            </column>
            <column name="CRT_TMS" type="DATETIME"
                    remarks="Timestamp of the record's creation">
                <constraints nullable="false"/>
            </column>
            <column name="MDF_USR" type="VARCHAR(255)" remarks="User that modified last this record">
                <constraints nullable="false"/>
            </column>
            <column name="MDF_TMS" type="DATETIME" remarks="Timestamp of the record's last modification">
                <constraints nullable="false"/>
            </column>
            <column name="DATE" type="DATE" remarks="Date for appointment">
                <constraints nullable="false"/>
            </column>
            <column name="HOUR" type="VARCHAR(20)" remarks="Hour for appointment">
                <constraints nullable="false"/>
            </column>
            <column name="SPECIALIZATION" type="VARCHAR(255)" remarks="Specialization of appointment">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="VARCHAR(255)" remarks="Status of user" defaultValue="PENDING">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="VARCHAR(255)" remarks="Description of appointment">
                <constraints nullable="true"/>
            </column>
            <column name="REJECT_REASON" type="VARCHAR(255)"
                    remarks="Reason of the rejection of appointment">
                <constraints nullable="true"/>
            </column>
            <column name="V" type="INT" remarks="Technical version of this record">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable remarks="Days off details." tableName="DAYS_OFF">
            <column name="DAYS_OFF_ID" remarks="Generated surrogate key." type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="DAYS_OFF_ID"/>
            </column>
            <column name="DOCTOR_ID" remarks="Id of the doctor that day"
                    type="VARCHAR2(255)">
                <constraints foreignKeyName="DAYS_OFF_DOCTOR_FK"
                             nullable="false"
                             references="CLIENT(USER_ID)"/>
            </column>
            <column name="DATE" remarks="Date of day off." type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" remarks="Description of day off" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="V" type="INT" remarks="Technical version of this record">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint columnNames="NAME" constraintName="SPECIALIZATION_NAME_UQ" tableName="SPECIALIZATION"/>

    </changeSet>

    <changeSet author="raluca.timonea" id="002">
        <comment>Initial Load Team details</comment>
        <loadData file="includes/data-specialization-initial-load.csv" tableName="SPECIALIZATION" relativeToChangelogFile="true"/>
        <loadData file="includes/data-users-initial-load.csv" tableName="CLIENT" relativeToChangelogFile="true"/>
    </changeSet>
</databaseChangeLog>